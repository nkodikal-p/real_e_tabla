<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="styles.css">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <title>eTabla</title>
</head>



<body>
  <div class="etabla-vertical-wrapper">
    <!-- 1. Image group -->
    <div class="etabla-group etabla-group-1">
      <div class="image-container">
        <img src="images/tablas.jpg" alt="eTabla">
        <div id="matraText"></div>
      </div>
    </div>
    <!-- 2. Taal selection and Play/Stop group -->
    <div class="etabla-group etabla-group-2">
      <select id="taalSelect"></select>
      <div id="taaldisplay">
        <div id="taal"></div>
      </div>
      <div id="mindexDisplay"></div>
      <div id="taaldisplay">
        <button class="modern-button" id="playTaalButton">Play</button>
        <button class="modern-button red" id="stopTaalButton">Stop</button>
      </div>
    </div>
    <!-- 3. BPM group -->
    <div class="etabla-group etabla-group-3">
      <div id="bpmDisplay">
        <button class="bpm-button" id="decreaseBpmButton">-</button>
        <span id="bpmValue">120</span>
        <button class="bpm-button" id="increaseBpmButton">+</button>
      </div>
      <label for="bpm">Tempo</label>
    </div>
    <!-- 4. Key group -->
    <div class="etabla-group etabla-group-4">
      <label for="keySelect">Key:</label>
      <select id="keySelect"></select>
    </div>
    <!-- 5. Tanpura group -->
    <div class="etabla-group etabla-group-5">
      <div style="margin-top: 10px;">
        <label for="tanpuraToggle">Tanpura:</label>
        <label class="switch">
          <input type="checkbox" id="tanpuraToggle">
          <span class="slider"></span>
        </label>
        <span class="switch-label" id="tanpuraSwitchLabel">Off</span>
      </div>
      <div class="tanpura-volume-container" style="margin-top: 8px; display: flex; align-items: center; gap: 8px;">
        <label for="tanpuraVolume" style="font-size: 0.95em;">Tanpura Volume</label>
        <input type="range" id="tanpuraVolume" min="0" max="1" step="0.01" value="0.25" style="width: 120px;">
      </div>
    </div>
  </div>

  <!-- Timestamp -->
  <div style="position: fixed; bottom: 8px; left: 0; width: 100%; text-align: center; color: #bbb; font-size: 0.5em; letter-spacing: 0.5px; z-index: 9999;">
    real e-tabla V3-07-29-25-17:56 Nilesh Kodikal
  </div>

  <script type="module" src="apps.js"></script>
  <!-- Improved initialization script with detailed error reporting -->
  <script>
    let eTablaApp;
    async function initializeApp() {
      try {
        // Wait for DOM elements to exist
        const requiredIds = [
          'playTaalButton', 'stopTaalButton', 'taalSelect', 'keySelect', 'bpmValue', 'decreaseBpmButton', 'increaseBpmButton', 'tanpuraToggle', 'tanpuraVolume', 'matraText'
        ];
        for (const id of requiredIds) {
          if (!document.getElementById(id)) {
            throw new Error(`Missing DOM element: ${id}`);
          }
        }
        eTablaApp = new ETabla();
        await eTablaApp.init();
        window.eTablaApp = eTablaApp;
      } catch (error) {
        // Show the actual error message for debugging
        console.error('Initialization failed:', error);
        alert('Failed to initialize eTabla.\n' + (error && error.message ? error.message : error));
      }
    }
    document.addEventListener('DOMContentLoaded', () => {
      // Always try to initialize on load
      initializeApp();
      const playButton = document.getElementById('playTaalButton');
      if (playButton) {
        playButton.addEventListener('click', () => {
          if (!window.eTablaApp) {
            initializeApp();
          }
        });
      } else {
        console.error('playTaalButton element not found in the DOM.');
      }
    });
  </script>

  <style>
    .etabla-vertical-wrapper {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: space-evenly;
      align-items: center;
      width: 100vw;
    }
    .etabla-group {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
  </style>
</body>

</html>